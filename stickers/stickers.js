_plugins_stickerMap = {
    "sticker1":"data:image/png;base64,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"   
}

if(Meteor.isClient)
{
    Template["chat.stickers"].events({
        
        'click #_stickersClose': function (e,t) {
            Meteor.call("_plugins_stickers_cancel", this._id);
        },
        
        'click ._pluginsticker': function (e,t) {
            stickerId = $(e.currentTarget).attr("id");
            Meteor.call("_plugins_stickers_sendSticker", Template.instance().data.chatId, stickerId, this._id)
        }
        
    });
    
    Template["chat.stickers"].helpers({

        sender: function () {
            return this.sender == Meteor.userId();
        }
        
    })
}
Meteor.methods({
    
    _plugins_stickers_cancel: function (msgId) {
        chat = Messages.findOne({_id:msgId});
        if(chat.type == "chat.stickers" && chat.sender == Meteor.userId()) Messages.remove({_id:msgId});
    },
    
    _plugins_stickers_sendSticker: function (chatId, stickerId, crcid) {
        chat = Messages.findOne({_id:crcid});
        if(chat.type == "chat.stickers") Messages.remove({_id:crcid});
        src = _plugins_stickerMap[stickerId];
        return PluginAPI.sendChatMessage(chatId, "<img class='_plugins-sticker' src='" + src + "'>")
    }
    
})